<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        background-color: #fff;
        position: relative;
        width: 100%;
        padding: 0;
        margin: 0;
        overflow: auto;
        user-select: none;
      }
      #main {
        margin-top: 1em;
        margin-left: 0.5em;
        margin-bottom: 1em;
        margin-right: 0.5em;

        display: flex;
        flex-flow: column wrap;
      }
      @media only screen and (min-width: 992px) {
        #main {
          margin: 5em;
        }
      }
      #menu {
        position: fixed;
        bottom: 0;
        right: 0;
        display: flex;
        flex-flow: row wrap;
        gap: 1px;
        z-index: 1;
      }
      #controls {
        display: flex;
        flex-flow: row wrap;
        justify-content: center;
        align-items: center;
        height: 100%;
        gap: 1px;
        margin: 0.5em;
      }
      #filemenu {
        gap: 1px;
      }
      #openfile {
        width: 200px;
      }
      .appearText {
        text-align: left;
        padding: 0.05em;
        /*display: block; */
        white-space: pre;
        position: relative;
      }
      .textContent {
        position: absolute;
        top: 0;
        left: 0;
        animation-name: appear;
        animation-duration: 1s;
        animation-fill-mode: forwards;
        /* display: flex;
  flex-flow: row wrap; */
      }
      .fadeOutSpan {
        position: absolute;
        top: 0;
        left: 0;
        animation-name: disappear;
        animation-duration: 1s;
        animation-fill-mode: forwards;
        /* display: flex;
  flex-flow: row wrap; */
      }
      .textContentSubSpan {

      }
      .keyControlDisplay {
        display: flex;
        flex-flow: row nowrap;
        gap: 4px;
        margin: 4px;
      }
      .keyControlDisplayItemContainer {
        display: flex;
        flex-flow: column nowrap;
        align-items: center;
        justify-content: center;
        gap: 4px;
        margin: 0.5em;
      }
      .keyControlDisplayItemLabel {
        text-align: center;
        color: #777;
      }
      .keyControlDisplayItem {
        padding: 0.5em 0.75em;
        border: #777 1px solid;
        border-radius: 4px;
        box-shadow: 0px 1px 2px #aaa;
        color: #777;
      }
      .italic {
        font-style: italic;
      }
      .underline {
        text-decoration: underline;
      }
      @keyframes appear {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes disappear {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body onload="run()">
    <div id="main"></div>
    <div id="menu">
      <div id="controls">
        <button id="backButton" disabled>back</button>
        <button id="nextButton" disabled>next</button>
      </div>
      <div id="filemenu">
        <input type="file" id="openfile" /><br />
        <select
          id="select_preset"
          aria-placeholder="or select preset"
          style="width: 150px"
        >
          <option value="preset">presets</option>
        </select>
        <a href="appear_help.html">about</a>
      </div>
    </div>
    <script>
      document
        .getElementById("nextButton")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          forward();
        });
      document
        .getElementById("backButton")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          back();
        });
      document.getRootNode().addEventListener("click", function (e) {
        console.log(e);

        const width = window.innerWidth;
        const halfWidth = width / 2;
        if (e.pageX > halfWidth) {
          forward();
        } else {
          back();
        }
      });

      document
        .getElementById("openfile")
        .addEventListener("change", function () {
          var fr = new FileReader();
          fr.onload = function () {
            //document.getElementById("filecontents").textContent = this.result;
            resetFrameHistory();
            var rawText = this.result;
            fileText = rawText.split(/\r\n|\n|\r/);
            document.getElementById("select_preset").value = "Select preset -";
            document.getElementById("main").replaceChildren();
            document.getElementById("main").innerHTML = "";
            forward();
            // Remove focus from file picker
            document.getElementById("openfile").blur();
          };
          fr.readAsText(this.files[0]);
        });

      const presetTexts = {
        "Select preset -": "",
        polysolid: `polysolid


There is always a space 
between the bed and the wall that is unfortunate
where the edges are
flat-handed
into
                  box~color,blue~replace,into,                  into~replace,flat-handed,                  flat-handed
I keep an empty plastic tub under my bed~replace,There is always a space,always an unfortunate space
Hard hat,~replace,keep,kept~replace,between the bed and the wall that is unfortunate,where the bed and the wall meet~color,#8B8000
        tonguey sneakers,~color,#8B8000
                        the flashlight~color,#8B8000
            all crammed themselves into one corner~replace,Hard hat,Hardhattong~replace,        tonguey sneakers,ueysneakers~replace,                        the flashlight,theflashlight
            Residual blankets made way for 
                                      impassive 
                                      clean polysolid~styleWhere,clean polysolid,textDecoration,underline~styleWhere,clean polysolid,color,red

                                Plastic is going to outlive me,~italic
    and flannel is going to outlive me~italic
    and fisher-price microphones
        are going to outlive me~italic
    and somewhere there is light
        its going to live me out
    and plaster is going to be reborn~replace,to live me,to wring me~styleLineMatchingfisher,color,blue

The lamplight is rain as well~color,blue
as well as it can be~replace, as well,~color,blue
And sometime in the night
it was hot enough~replace,rain,rain at least
that I shifted and carefully                 (so as not to wake you)~replace,And,&
pinched my fingers to ~replace,And,&~replace,\\(,((~replace,\\),))
my collarbone and peeled~replace,\\(,((~replace,\\),))
my skin back~replace,\\(,((~replace,\\),))
until I was shucked in the
                                    still
                                    already-breathed air.`,
        refracted: `through~styleWhere,through,color,purple
this~setLine,0,through my~styleWhere,this,color,purple
crystal~setLine,0,through my own~setLine,1,this prayer~styleWhere,crystal,color,purple
of~setLine,0,through my own small~setLine,1,this prayer like~setLine,2,crystal atop~styleWhere,of,color,purple
water~setLine,0,through my own small failings /~setLine,1,this prayer like smoke~setLine,2,crystal atop wood /~setLine,3,of ether~styleWhere,water,color,purple
I~setLine,0,through my own small failings / palms~setLine,1,this prayer like smoke curdling~setLine,2,crystal atop wood / each~setLine,3,of ether or~setLine,4,water whispering~styleWhere,I,color,purple
glimpse~setLine,0,through my own small failings / palms re-cup~setLine,1,this prayer like smoke curdling wood /~setLine,2,crystal atop wood / each history~setLine,3,of ether or the~setLine,4,water whispering a~setLine,5,I press~styleWhere,glimpse,color,purple
refracted~setLine,0,through my own small failings / palms re-cup under~setLine,1,this prayer like smoke curdling wood / extending~setLine,2,crystal atop wood / each history self-deceiving~setLine,3,of ether or the grape~setLine,4,water whispering a gentle~setLine,5,I press pinkies~setLine,6,glimpse a~styleWhere,refracted,color,purple
the~setLine,0,through my own small failings / palms re-cup under the~setLine,1,this prayer like smoke curdling wood / extending my~setLine,2,crystal atop wood / each history self-deceiving separation~setLine,3,of ether or the grape and~setLine,4,water whispering a gentle porousness~setLine,5,I press pinkies vainly /~setLine,6,glimpse a flash~setLine,7,refracted and~styleWhere,the,color,purple
entire~setLine,0,through my own small failings / palms re-cup under the gliding~setLine,1,this prayer like smoke curdling wood / extending my stalactite~setLine,2,crystal atop wood / each history self-deceiving separation by~setLine,3,of ether or the grape and its~setLine,4,water whispering a gentle porousness to~setLine,5,I press pinkies vainly / so~setLine,6,glimpse a flash of~setLine,7,refracted and therefore~setLine,8,the last~styleWhere,entire,color,purple
universe~setLine,0,through my own small failings / palms re-cup under the gliding water~setLine,1,this prayer like smoke curdling wood / extending my stalactite skin~setLine,2,crystal atop wood / each history self-deceiving separation by seams~setLine,3,of ether or the grape and its skin~setLine,4,water whispering a gentle porousness to me~setLine,5,I press pinkies vainly / so to~setLine,6,glimpse a flash of everything~setLine,7,refracted and therefore held~setLine,8,the last lights~setLine,9,entire opening:~styleWhere,universe,color,purple`,
        the_kitchen: `March 8 2025 - the kitchen of 700 Broderick
you call me back a day later at 12:08
the near-spring sun slow cooking my pant legs
a warbling by my kitchen window
two rock doves nitpicking / arguing / circling
the way you and grandma used to do
in the house on the hill with the earth brick floors
her in the chair~setLine,1,you call me back at 12:08
both visible through the TV passthrough
(that's gone now)~setLine,3,a warbling by my window
(so is the automatic chair I used to tilt on the brink of eternity with)~setLine,2,the near-spring sun slow cooking my legs~setLine,5,you and grandma used to
the chatter of the TV filling up into static~setLine,4,some rock doves nitpicking - arguing - circling
quiet now~setLine,5,you and grandma~setLine,6,in the house with the earth brick floors
the redwoods only interspersed with faint cooing
as you drag your robe over your knobbly spine~setLine,2,the sun cooking my legs~setLine,5,and grandma
and slowly~setLine,4,some rock doves arguing - circling~setLine,9,(that's now)~setLine,11,the chatter of the TV filling up
descend~setLine,2,the sun on my legs~setLine,5,grandma~setLine,6,in the house with the brick floors~setLine,8,visible through the TV passthrough
the carpeted staircase~setLine,4,some birds arguing - circling~setLine,12,quiet
the phone is on the couch~setLine,1,you call me back at noon
but must have moved somewhere~setLine,0,Saturday - the kitchen~setLine,4,some birds circling~setLine,8,visible through the passthrough~setLine,9,(now)~setLine,15,slowly~setLine,18,the phone was on the couch
there~setLine,6,the brick floors
on the bathroom sink~setLine,4,some birds~setLine,8,visible through the wall~setLine,9,~setLine,20,here
with the light blinking green~setLine,12,
you reach there~setLine,1,you call me~setLine,18,the phone on the couch
in the dark~setLine,10,(so is the chair I used to tilt on the brink with)~setLine,14,as you drag your robe over your spine
to dial me~setLine,11,the static filling up
well hey there noah
what are you up to in the city these days?~setLine,3,a warbling by the window~setLine,22,with the light blinking~setLine,25,dial me
you still live in that apartment with your roommates?~setLine,14,as you drag over your spine~setLine,21,on the sink
right - right~setLine,2,the sun on me
a pause~setLine,16,~setLine,22,~setLine,24,in dark
how are you and A doing?~setLine,1,~setLine,10,(the chair I used to tilt with)~setLine,17,the staircase~setLine,21,the sink~setLine,22,blinking
we broke up years ago grandpa~setLine,13,the redwoods faintly cooing~setLine,18,the phone~setLine,19,moved somewhere~setLine,20,~setLine,22,~setLine,26,hey noah~setLine,27,what are you up to?~setLine,28,you still live in that apartment
and I tell you about this new woman from Texas~setLine,0,the kitchen~setLine,17,~setLine,22,blinking~setLine,23,you reach~setLine,24,~setLine,29,right
re-folding my legs on the bench and squinting in the sun~setLine,22,
oh great~setLine,2,the sun~setLine,14,you drag your spine~setLine,22,blinking~setLine,26,~setLine,28,you still live~setLine,31,me and A~setLine,32,broke up years ago
how about you grandpa? what's new?~setLine,3,a warbling~setLine,13,the redwoods~setLine,22,~setLine,29,~setLine,30,~setLine,35,that's great
oh - nothing much - you say~setLine,11,the static~setLine,22,blinking~setLine,27,what are you~setLine,29,~setLine,32,broke up~setLine,33,this new woman~setLine,35,
nothing much~setLine,0,kitchen~setLine,34,in the sun~setLine,36,grandpa?~setLine,37,you say`,
        answered: `I know you asked me already



and I answered already but I feel
something needs to be flushed out in full
so, simply:


it is the brush on your fingers webbing
& in the fingertips brushing 
        it is the edges of film in the home video
        and thumb that gets in the shot
                it is the tune rolling tidally
                over behind your lips
                        it is the slimy clasped can
                        and the gloved hand
                                it is watching the stars to check
                                which ones might go out soon~replace,needs to be flushed out in full,is flushing me out
                                and thanking them for stopping by
        & it is the memory
        behind the memory~replace,([A-Za-z]+)ing\\W,$1ed 
        a thousand times~replace,memory,memorymemorymemory
        the original true thing~replace,memory,memory
        nesting in the break~replace,emorym,emoryinm

_~styleLine,24,color,blue~setLine,0,I know I’ve already answered
_~styleLine,23,color,blue~styleLine,22,color,blue~styleLine,21,color,blue~setLine,1,
_~styleLine,20,color,blue~setLine,2,you twice but since you asked I haven’t been able to stop
_~styleLine,19,color,blue~setLine,3,thinking about it
_~styleLine,18,color,blue~setLine,4,there was a strange echo in the base of your throat as you
_~styleLine,17,color,blue~setLine,5,		            enunciated
_~styleLine,16,color,blue~setLine,6,okay					                          something like
_~styleLine,15,color,blue~setLine,7,	  so              						                      this
_~styleLine,14,color,blue~setLine,8,			
_~styleLine,13,color,blue~setLine,9,                                            basically
_~styleLine,12,color,blue~setLine,10,                                            imagine a line turning into a field
_~styleLine,11,color,blue~setLine,11,                                            the sweeping expansion of that
_~styleLine,10,color,blue~setLine,12,                                            and the way it spreads along your
_~styleLine,9,color,blue~setLine,13,                                            chest to fill each space in your
_~styleLine,8,color,blue~setLine,14,                                            organells
_~styleLine,7,color,blue~setLine,15,
_~styleLine,6,color,blue~setLine,16,		             or if you 
_~styleLine,5,color,blue~setLine,17,     have trouble consider a
_~styleLine,4,color,blue~setLine,18,   broadknife carving away
_~styleLine,3,color,blue~setLine,19,      the dead skin from the
_~styleLine,2,color,blue~setLine,20,   base of your heel its soft
_~styleLine,1,color,blue~styleLine,24,color,black~styleLine,23,color,black~styleLine,22,color,black~setLine,21,                             scraping`,
        status: `status











_~setLine,4,You were a friend~setLine,6,I was a friend~styleLineWhere,4,You were,color,blue~styleLineWhere,6,I was,color,red

_~setLine,4,You were a crush~setLine,6,I was a crush

_~setLine,4,You were waiting that summer~setLine,6,I was waiting that summer

_~setLine,4,You were a lover~setLine,6,I was a lover

_~setLine,4,You were a path to clarity~setLine,6,I was a lover

_~setLine,4,You were away~setLine,6,I was a lover

_~setLine,4,You were a panel of light~setLine,6,I was a lover

_~setLine,4,You were somewhere blurry in the back of the room~setLine,6,I was a lover

_~setLine,4,You were smiling~setLine,6,I was watching your smile

_~setLine,4,You were unrolling your socks across your legs~setLine,6,I was watching your smile

_~setLine,4,You were whispering~setLine,6,I was watching your smile

_~setLine,4,You were offline~setLine,6,I was a panel of light

_~setLine,4,You were trembling by the water, hands around your shins as if around the mast of a ship~setLine,6,I was watching the waves grasp at the rivers edge

_~setLine,4,You were sinking into a dune~setLine,6,I was watching the waves grasp at the shore

_~setLine,4,You were forgetting me~setLine,6,I was a panel of light

_~setLine,4,You were forgetting all panels of light~setLine,6,I was in my bed

_~setLine,4,You were away~setLine,6,I was on the living room couch

_~setLine,4,You were away~setLine,6,I was getting up from the couch

_~setLine,4,You were away~setLine,6,I was boarding a plane

_~setLine,4,You were away and trembling~setLine,6,I was buying a cheap mattress

_~setLine,4,You were away and trembling but forgetting~setLine,6,I was attending classes

_~setLine,4,You were somewhere blurry~setLine,6,I was falling onto a cheap mattress and laying there for some time

_~setLine,4,You were away and forgetting but smiling~setLine,6,I was getting up from the ground

_~setLine,4,You were away~setLine,6,I was boarding a plane

_~setLine,4,You were away~setLine,6,I was buying a expensive mattress

_~setLine,4,You were paused~setLine,6,I was buying sunflowers

_~setLine,4,You were sending a text~setLine,6,I was buying contact solution

_~setLine,4,You were flying~setLine,6,I was laying on my expensive mattress~setLine,8,She was taking our her contacts~styleLineWhere,8,She was,color,purple

_~setLine,4,You were walking on the Japantown bridge~setLine,6,I was walking on the Japantown bridge~setLine,8,

_~setLine,4,You were falling asleep to the roar of firetrucks~setLine,6,I was falling asleep to the roar of firetrucks

_~setLine,4,You were asking about the future~setLine,6,I was thinking about buying more contact solution

_~setLine,4,You were away~setLine,6,I was reading by the windowsill~setLine,8,She was baking bread

_~setLine,4,You were away~setLine,6,I was reading by the windowsill~setLine,8,She was putting sunflowers by the windowsill

_~setLine,4,You were a vocoder rasp~setLine,6,I was a panel of light~setLine,8,She was playing ukelele on the windowsill

_~setLine,4,You were a vocoder rasp~setLine,6,I was explaining my history~setLine,8,She was listening

_~setLine,4,You were a vocoder rasp~setLine,6,I was apologizing~setLine,8,She was crying

_~setLine,4,You were away~setLine,6,I was moving to Oakland~setLine,8,She was moving to Oakland

_~setLine,4,You were away~setLine,6,I was reading by the windowsill~setLine,8,She was putting sunflowers by the windowsill

_~setLine,4,You were away~setLine,6,I was reading a letter~setLine,8,She was listening

_~setLine,4,You were away~setLine,6,I was listening~setLine,8,She was reading a letter

_~setLine,4,You were following a line from the Nevada mountains along the gold rush trails~setLine,6,I was buying a mid-price desk~setLine,8,

_~setLine,4,You were passing into a shaded valley~setLine,6,I was considering new paitings for the walls

_~setLine,4,You were occupying a house by a ranch with a treehouse in front~setLine,6,I was sending a text

_~setLine,4,You were sharing a towel~setLine,6,I was driving south in the rain

_~setLine,2,He was sharing a towel~setLine,4,You were sharing a towel~setLine,6,I was apologizing for the late arrival~styleLineWhere,2,He was,color,green

_~setLine,2,He was sharing a towel~setLine,4,You were sharing a towel~setLine,6,I was showering

_~setLine,2,He was dancing~setLine,4,You were playing music in the kitchen~setLine,6,I was dancing

_~setLine,2,He was serving dinner~setLine,4,You were listening~setLine,6,I was playing guitar

_~setLine,2,He was asking about my history~setLine,4,You were listering~setLine,6,I was explaining my history

_~setLine,2,He was listening~setLine,4,You were listering~setLine,6,I was skipping over a question about the future

_~setLine,2,He was showering~setLine,4,You were making tea~setLine,6,I was driving north in the rain

_~setLine,2,He was pouring tea~setLine,4,You were drinking tea~setLine,6,I was away

_~setLine,2,He was drinking tea~setLine,4,You were drinking tea~setLine,6,`,
        look_for: `these days i mostly look for what isn't there
no songs to teach me anymore
I've grown too specific - a philosophy
unreachable save for fleeting images
of blue crab cakes
who can refract my anger when you
are being both kind and generous hurt
is something more raw and barren - a quicksand
of the gut. I leave enduring to consider
how much you can hold right now the songs
speaking my name don't talk about anything
directly. they couldn't possibly there isn't a thing
to say. an eclipse is defined by its edges, a gap previously
illuminated. 

_~clearLineStyle,0~styleLine,0,color,lightgray~styleLineWhere,0,these days,color,black
_~clearLineStyle,1~styleLine,1,color,lightgray~styleLineWhere,1,teach,color,black
_~clearLineStyle,2~styleLine,2,color,lightgray~styleLineWhere,2,a philosophy,color,black
_~clearLineStyle,3~styleLine,3,color,lightgray~styleLineWhere,3,for fleeting images,color,black
_~clearLineStyle,4~styleLine,4,color,lightgray~styleLineWhere,4,blue,color,black
_~clearLineStyle,5~styleLine,5,color,lightgray~styleLineWhere,5,can refract my,color,black
_~clearLineStyle,6~styleLine,6,color,lightgray~styleLineWhere,6,generous hurt,color,black
_~clearLineStyle,7~styleLine,7,color,lightgray~styleLineWhere,7,something,color,black~styleLineWhere,7,raw and,color,black
_~clearLineStyle,8~styleLine,8,color,lightgray~styleLineWhere,8,enduring,color,black
_~clearLineStyle,9~styleLine,9,color,lightgray~styleLineWhere,9,the songs,color,black
_~clearLineStyle,10~styleLine,10,color,lightgray~styleLineWhere,10,don't talk,color,black
_~clearLineStyle,11~styleLine,11,color,lightgray~styleLineWhere,11,directly.,color,black~styleLineWhere,11,there isn't a thing,color,black
_~clearLineStyle,12~styleLine,12,color,lightgray~styleLineWhere,12,to say.,color,black~styleLineWhere,12,a gap,color,black
_~clearLineStyle,13~styleLine,13,color,lightgray~styleLineWhere,13,illuminated,color,black

_~clearLineStyle,0~styleLine,0,color,lightgray~styleLineWhere,0,look for,color,black
_~clearLineStyle,1~styleLine,1,color,lightgray~styleLineWhere,1,songs,color,black~styleLineWhere,1,more,color,black
_~clearLineStyle,2~styleLine,2,color,lightgray~styleLineWhere,2,specific,color,black
_~clearLineStyle,3~styleLine,3,color,lightgray~styleLineWhere,3,reach,color,black~styleLineWhere,3,for,color,black~styleLineWhere,3,images,color,black
_~clearLineStyle,4~styleLine,4,color,lightgray~styleLineWhere,4,of blue crab cakes,color,black
_~clearLineStyle,5~styleLine,5,color,lightgray~styleLineWhere,5,refract,color,black
_~clearLineStyle,6~styleLine,6,color,lightgray~styleLineWhere,6,being,color,black
_~clearLineStyle,7~styleLine,7,color,lightgray~styleLineWhere,7,something more raw and barren,color,black
_~clearLineStyle,8~styleLine,8,color,lightgray~styleLineWhere,8,leave,color,black
_~clearLineStyle,9~styleLine,9,color,lightgray~styleLineWhere,9,the songs,color,black
_~clearLineStyle,10~styleLine,10,color,lightgray~styleLineWhere,10,speaking,color,black~styleLineWhere,10,anything,color,black
_~clearLineStyle,11~styleLine,11,color,lightgray~styleLineWhere,11,directly. they couldn't possibly,color,black
_~clearLineStyle,12~styleLine,12,color,lightgray~styleLineWhere,12,say. an eclipse is,color,black
_~clearLineStyle,13~styleLine,13,color,lightgray~styleLineWhere,13,illuminated,color,black

_~clearLineStyle,0~styleLine,0,color,lightgray~styleLineWhere,0,what isn't there,color,black
_~clearLineStyle,1~styleLine,1,color,lightgray~styleLineWhere,1,anymore,color,black
_~clearLineStyle,2~styleLine,2,color,lightgray~styleLineWhere,2,I've grown too,color,black
_~clearLineStyle,3~styleLine,3,color,lightgray~styleLineWhere,3,unreachable save for fleeting images,color,black
_~clearLineStyle,4~styleLine,4,color,lightgray
_~clearLineStyle,5~styleLine,5,color,lightgray~styleLineWhere,5,you,color,black
_~clearLineStyle,6~styleLine,6,color,lightgray~styleLineWhere,6,are being both kind and generous,color,black
_~clearLineStyle,7~styleLine,7,color,lightgray~styleLineWhere,7,raw and barren,color,black
_~clearLineStyle,8~styleLine,8,color,lightgray~styleLineWhere,8,I,color,black~styleLineWhere,8,consider,color,black
_~clearLineStyle,9~styleLine,9,color,lightgray~styleLineWhere,9,how,color,black~styleLineWhere,9,you can,color,black
_~clearLineStyle,10~styleLine,10,color,lightgray~styleLineWhere,10,speak,color,black~styleLineWhere,10,my name,color,black
_~clearLineStyle,11~styleLine,11,color,lightgray~styleLineWhere,11,there isn't a thing,color,black
_~clearLineStyle,12~styleLine,12,color,lightgray~styleLineWhere,12,defined by its edges,color,black
_~clearLineStyle,13~styleLine,13,color,lightgray~styleLineWhere,13,\\.,color,black`,
        chaos_has_its_place: `Chaos Has Its Place~underline

































_~setLine,2,                                                                                                       Wiser than your mother~setLine,3,                                                                                                   and father both - you used duct tape to divide~setLine,4,                                                                                                     the room.
_~setLine,2,~setLine,3,~setLine,4,~setLine,5,
_~setLine,26,                                                                                                                             By wednesday you had gone so~setLine,27,                                                                                                                           deeply inside that the whole~setLine,28,                                                                                                                            house was clean~setLine,29,                                                                                                                           and I had to roll bowls on linoleum;
_~setLine,26,~setLine,27,~setLine,28,~setLine,29,
_~setLine,5,                                                                   something you learned~setLine,6,                                                                    in the overwhelming simplicity of~setLine,7,                                                                    a urine pad;
_~setLine,5,~setLine,6,~setLine,7,~setLine,8,
_~setLine,15,                                                                                                                                                                                               the system of requirements to~setLine,16,                                                                                                                                                                                              decline has a determinant of zero~setLine,17,                                                                                                                                                                                              thus its basis vectors define zero volume.
_~setLine,15,~setLine,16,~setLine,17,~setLine,18,
_~setLine,10,                   A cardboard box~setLine,11,                   collapses in overwhelming~setLine,12,                   heat.
_~setLine,10,~setLine,11,~setLine,12,~setLine,13,
_~setLine,4,                                                                                                                           We swab the inside of your lip with~setLine,5,                                                                                                                             a wet sponge. It is easiest~setLine,6,                                                                                                                            to show that a determinant of zero~setLine,7,                                                                                                                             indicates dependence.
_~setLine,4,~setLine,5,~setLine,6,~setLine,7,
_~setLine,30,                                                                                                     It is easiest to show that~setLine,31,                                                                                                      something can be removed;~setLine,32,                                                                                                     an unwanted extension of the original~setLine,33,                                                                                                      permeates.
_~setLine,30,~setLine,31,~setLine,32,~setLine,33,
_~setLine,4,                                     I watch you fold into a frog - a turtle - a small songbird~setLine,5,                                    a sleeping paper child~setLine,6,                                    with eye corners moreover crumpled.
_~setLine,4,~setLine,5,~setLine,6,~setLine,7,
_~setLine,21,                                                                                                                                                                     The urge faded the way an urge fades.
`,
        the_sweetbay_magnolia: `









































_~setLine,41,its roots
_~setLine,40,trace you back to
_~setLine,39,praying one day to
_~setLine,38,the sweetbay magnolia
_~setLine,37,I look to the canopy
_~setLine,36,for the second time while
_~setLine,35,my name touches your lips
_~setLine,34,of a modern city
_~setLine,33,the failings
_~setLine,32,exactly like this
_~setLine,31,caught in the streetlight
_~setLine,30,I am eventually
_~setLine,29,jogging in my spikes
_~setLine,28,circling the block
_~setLine,27,and selling only pastries
_~setLine,26,promising an orange
_~setLine,25,from the cafe
_~setLine,24,refusing to purchase
_~setLine,23,over the borderline
_~setLine,22,while Vienna tilts
_~setLine,21,beneath my careful body
_~setLine,20,beneath your daring body
_~setLine,19,beneath the blanket
_~setLine,18,whiskers of bermuda grass
_~setLine,17,through
_~setLine,16,where light shines
_~setLine,15,into a window
_~setLine,14,your lips
_~setLine,13,a smile cracks
_~setLine,12,the frame just before
_~setLine,11,turquoise glimmering
_~setLine,10,to meet your eyes there
_~setLine,9,to the starting line
_~setLine,8,scrambling back
_~setLine,7,I am always
_~setLine,6,the way we run them
_~setLine,5,our stories
_~setLine,4,we cannot tell
_~setLine,3,my vasculature
_~setLine,2,like a fishing knife through
_~setLine,1,time slips forward
_~setLine,0,frustratingly`,
        what_blinding_light: `

































_~setLine,0,what blinding light
_~setLine,19,                                                           That bed in that shaft of light~setLine,20,                                                                   doesn't exist anymore
_~setLine,21,                                                    And neither does your white blouse - or your white lace underneath~setLine,22,                                              Nor the freckles along your collarbone~setLine,23,                                                                       Or the sounds the walls rang with
_~setLine,8,                      It marks the cornerstone of my new comfort~setLine,9,                   The way a toddler returns to a mother on the playground~setLine,10,                               I plumb deeper and deeper
_~setLine,19,~setLine,20,~setLine,21,~setLine,22,~setLine,23,~setLine,30,                                           Something split between your lips~setLine,31,                                         Almost a pleading
_~setLine,8,~setLine,9,~setLine,10,~setLine,32,                                                                Why couldn't I have said yes?~setLine,33,                                                         What obstacle - in what blinding light - prevented it?
_~setLine,2,                                                                                 I have very few conversations these days~setLine,3,                                                                                     There is no negotiating with myself
_~setLine,4,                                                                                     When I know who will win~setLine,30,~setLine,31,~setLine,32,~setLine,33,
_~setLine,12,            The blue wallet sags loose~setLine,13,            With an unchecked ticket
_~setLine,2,~setLine,3,~setLine,4,~setLine,22,                                                                                                             Have you ever looped bliss?~setLine,23,                                                                                                              A frame spiraling loses color at the edges~setLine,24,                                                                                                          Cornering softly into itself
_~setLine,12,~setLine,13,~setLine,18,I was inexplicably bored- all mystery vanished - I could walk in and tumble you like a bag of potatoes- my teeth on your neck- your fingers and your fingers
_~setLine,22,~setLine,23,~setLine,24,~setLine,25,                                                                  But it was hard to sit with you in that diner~setLine,26,                                                      And describe him
_~setLine,18,~setLine,27,                                         And recognize that you had thought no farther than a flannel coat a beard a mug of beer~setLine,28,                                   It was hard to remember my tongue
_~setLine,9,                                                                                             Language stilts when restrained~setLine,10,                                                                                           If you listened to me mention the ferry boat~setLine,11,                                                                                 And the salmon ladder
_~setLine,12,                                                                                                                Could you feel the steps escalate?~setLine,25,~setLine,26,~setLine,27,~setLine,28,
_~setLine,19,                                                                   I know no question except
_~setLine,9,~setLine,10,~setLine,11,~setLine,12,~setLine,20,                                                                            How can I save you from everything you want?`,
        solarium: `Eight planets curl in the dark~style,transform,rotate(0deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
Falling towards / rushing to escape the sun~style,transform,rotate(25.7deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
Dayward movement - and with it ~style,transform,rotate(51.4deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
A centripetal force away from myself~style,transform,rotate(77.1deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
I clutch my bedframe and ~style,transform,rotate(102.8deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
Wait for the ceiling to recede again~style,transform,rotate(128.5deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
That night - dreamt: I am shooing~style,transform,rotate(154.2deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
A stream of new turtle hatchlings~style,transform,rotate(180deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
Wafting palms over sand - holding my teeth~style,transform,rotate(-154.2deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
As each instant my gaze flits away~style,transform,rotate(-128.5deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
A shadow plucks the next ~style,transform,rotate(-102.8deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
Soft-shelled prospector and flashes up~style,transform,rotate(-77.1deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
My eyes chase to sky~style,transform,rotate(-51.4deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%
And fixate on lost movement~style,transform,rotate(-25.7deg)~style,position,fixed~style,left,50vw~style,top,50vh~style,transformOrigin,-3em 50%`,
        formation: `Do not be~position,70vw,35vh~rotation,20deg,-2em,50%~color,red
wandering through~position,70vw,35vh~rotation,80deg,-2em,50%~color,blue
this dark night~position,70vw,35vh~rotation,140deg,-2em,50%~color,green
without your~position,70vw,35vh~rotation,200deg,-2em,50%~color,black
heart beating~position,70vw,35vh~rotation,260deg,-2em,50%~color,orange
in your arms~position,70vw,35vh~rotation,320deg,-2em,50%~color,purple

afraid of~position,50vw,75vh~rotation,20deg,-2em,50%~color,red
their hall of furtive glances~position,50vw,75vh~rotation,80deg,-2em,50%~color,blue
lit only by~position,50vw,75vh~rotation,140deg,-2em,50%~color,green
glimmering alms~position,50vw,75vh~rotation,200deg,-2em,50%~color,black
I drop my belongings~position,50vw,75vh~rotation,260deg,-2em,50%~color,orange
twitching ceaselessly~position,50vw,75vh~rotation,320deg,-2em,50%~color,purple

the way she calls~position,30vw,65vh~rotation,20deg,-2em,50%~color,red
turns my heart~position,30vw,65vh~rotation,80deg,-2em,50%~color,blue
a shrinking spark ~position,30vw,65vh~rotation,140deg,-2em,50%~color,green
I am lost in~position,30vw,65vh~rotation,200deg,-2em,50%~color,black
the clatterings~position,30vw,65vh~rotation,260deg,-2em,50%~color,orange
I am descending~position,30vw,65vh~rotation,320deg,-2em,50%~color,purple

there is nothing~position,70vw,65vh~rotation,20deg,-2em,50%~color,red
against itself~position,70vw,65vh~rotation,80deg,-2em,50%~color,blue
in time's current~position,70vw,65vh~rotation,140deg,-2em,50%~color,green
all directions~position,70vw,65vh~rotation,200deg,-2em,50%~color,black
lurching~position,70vw,65vh~rotation,260deg,-2em,50%~color,orange
beyond potential~position,70vw,65vh~rotation,320deg,-2em,50%~color,purple

save for love~position,30vw,35vh~rotation,20deg,-2em,50%~color,red
I forget~position,30vw,35vh~rotation,80deg,-2em,50%~color,blue
no single moment~position,30vw,35vh~rotation,140deg,-2em,50%~color,green
I carry my head~position,30vw,35vh~rotation,200deg,-2em,50%~color,black
forward: riding~position,30vw,35vh~rotation,260deg,-2em,50%~color,orange
into something bright~position,30vw,35vh~rotation,320deg,-2em,50%~color,purple

in her whispering~position,50vw,25vh~rotation,20deg,-2em,50%~color,red
the weight of forgiveness~position,50vw,25vh~rotation,80deg,-2em,50%~color,blue
repatriated~position,50vw,25vh~rotation,140deg,-2em,50%~color,green
like a top coming to rest~position,50vw,25vh~rotation,200deg,-2em,50%~color,black
on a lapse of judgement~position,50vw,25vh~rotation,260deg,-2em,50%~color,orange
filling all spaces~position,50vw,25vh~rotation,320deg,-2em,50%~color,purple

_~positionLine,0,50vw,50vh~rotationLine,0,20deg,-2em,50%
_~positionLine,7,50vw,50vh~rotationLine,7,80deg,-2em,50%
_~positionLine,14,50vw,50vh~rotationLine,14,140deg,-2em,50%
_~positionLine,21,50vw,50vh~rotationLine,21,200deg,-2em,50%
_~positionLine,28,50vw,50vh~rotationLine,28,260deg,-2em,50%
_~positionLine,35,50vw,50vh~rotationLine,35,320deg,-2em,50%

_~setLine,0,~setLine,7,~setLine,14,~setLine,21,~setLine,28,~setLine,35,

_~positionLine,1,50vw,50vh~rotationLine,1,20deg,-2em,50%
_~positionLine,8,50vw,50vh~rotationLine,8,80deg,-2em,50%
_~positionLine,15,50vw,50vh~rotationLine,15,140deg,-2em,50%
_~positionLine,22,50vw,50vh~rotationLine,22,200deg,-2em,50%
_~positionLine,29,50vw,50vh~rotationLine,29,260deg,-2em,50%
_~positionLine,36,50vw,50vh~rotationLine,36,320deg,-2em,50%

_~setLine,1,~setLine,8,~setLine,15,~setLine,22,~setLine,29,~setLine,36,

_~positionLine,2,50vw,50vh~rotationLine,2,20deg,-2em,50%
_~positionLine,9,50vw,50vh~rotationLine,9,80deg,-2em,50%
_~positionLine,16,50vw,50vh~rotationLine,16,140deg,-2em,50%
_~positionLine,23,50vw,50vh~rotationLine,23,200deg,-2em,50%
_~positionLine,30,50vw,50vh~rotationLine,30,260deg,-2em,50%
_~positionLine,37,50vw,50vh~rotationLine,37,320deg,-2em,50%

_~setLine,2,~setLine,9,~setLine,16,~setLine,23,~setLine,30,~setLine,37,

_~positionLine,3,50vw,50vh~rotationLine,3,20deg,-2em,50%
_~positionLine,10,50vw,50vh~rotationLine,10,80deg,-2em,50%
_~positionLine,17,50vw,50vh~rotationLine,17,140deg,-2em,50%
_~positionLine,24,50vw,50vh~rotationLine,24,200deg,-2em,50%
_~positionLine,31,50vw,50vh~rotationLine,31,260deg,-2em,50%
_~positionLine,38,50vw,50vh~rotationLine,38,320deg,-2em,50%

_~setLine,3,~setLine,10,~setLine,17,~setLine,24,~setLine,31,~setLine,38,

_~positionLine,4,50vw,50vh~rotationLine,4,20deg,-2em,50%
_~positionLine,11,50vw,50vh~rotationLine,11,80deg,-2em,50%
_~positionLine,18,50vw,50vh~rotationLine,18,140deg,-2em,50%
_~positionLine,25,50vw,50vh~rotationLine,25,200deg,-2em,50%
_~positionLine,32,50vw,50vh~rotationLine,32,260deg,-2em,50%
_~positionLine,39,50vw,50vh~rotationLine,39,320deg,-2em,50%

_~setLine,4,~setLine,11,~setLine,18,~setLine,25,~setLine,32,~setLine,39,

_~positionLine,5,50vw,50vh~rotationLine,5,20deg,-2em,50%
_~positionLine,12,50vw,50vh~rotationLine,12,80deg,-2em,50%
_~positionLine,19,50vw,50vh~rotationLine,19,140deg,-2em,50%
_~positionLine,26,50vw,50vh~rotationLine,26,200deg,-2em,50%
_~positionLine,33,50vw,50vh~rotationLine,33,260deg,-2em,50%
_~positionLine,40,50vw,50vh~rotationLine,40,320deg,-2em,50%

_~setLine,5,~setLine,12,~setLine,19,~setLine,26,~setLine,33,~setLine,40,`,
        review: `























































































_~setLine,1,one of the few movies in the world to express with~positionLine,1,453px,6.5em
_~setLine,2,near perfection the truth about the~positionLine,2,453px,8.0em
_~setLine,3,soul-destroying effects a city has on lovers\\, the~positionLine,3,453px,9.5em
_~setLine,4,pain it can cause them\\, the monsters that it turns~positionLine,4,453px,11.0em
_~setLine,5,them into.~positionLine,5,453px,12.5em
_~setLine,1,~setLine,2,~setLine,3,~setLine,4,~setLine,5,~setLine,3,lovers~positionLine,3,687px,9.5em
_~setLine,3,lovers~positionLine,3,687px,13.25em~setLine,6,Silly poetry + Cameraman with existentialism =~positionLine,6,476px,9.5em
_~setLine,3,lover~positionLine,3,687px,17.0em~setLine,7,this movie.~positionLine,7,476px,11.0em
_~setLine,3,lover~positionLine,3,687px,20.75em~setLine,6,~setLine,7,~setLine,6,Cameraman~positionLine,6,568px,9.5em
_~setLine,3,lover~positionLine,3,687px,24.5em~setLine,6,Cameraman~positionLine,6,568px,13.25em~setLine,8,the film has endured due to its lyrical quality in~positionLine,8,119px,8.0em
_~setLine,3,lover~positionLine,3,687px,28.25em~setLine,6,Camera~positionLine,6,568px,17.0em~setLine,9,depicting a love affair in post World War II~positionLine,9,119px,9.5em
_~setLine,3,lover~positionLine,3,687px,32.0em~setLine,6,Camera~positionLine,6,568px,20.75em~setLine,8,~setLine,9,~setLine,9,World War II~positionLine,9,310px,9.5em
_~setLine,3,over~positionLine,3,687px,35.75em~setLine,6,Cam~positionLine,6,568px,24.5em~setLine,9,World War II~positionLine,9,310px,13.25em~setLine,10,I might not be a great fan of the French New Wave\\,~positionLine,10,374px,9.5em
_~setLine,3,over~positionLine,3,687px,39.5em~setLine,6,Cam~positionLine,6,568px,28.25em~setLine,9,World War II~positionLine,9,310px,17.0em~setLine,11,but sure I am not a fan of this film. Romantinc\\,~positionLine,11,374px,11.0em
_~setLine,3,over~positionLine,3,687px,43.25em~styleLine,3,color,red~setLine,6,Cam~positionLine,6,568px,32.0em~setLine,9,World War II~positionLine,9,310px,20.75em~setLine,12,poetical but too heavy for my tastes.~positionLine,12,374px,12.5em
_~setLine,6,a~positionLine,6,568px,35.75em~setLine,9,World War II~positionLine,9,310px,24.5em~setLine,10,~setLine,11,~setLine,12,~setLine,10,French~positionLine,10,580px,9.5em
_~setLine,6,a~positionLine,6,568px,39.5em~setLine,9,World War II~positionLine,9,310px,28.25em~setLine,10,French~positionLine,10,580px,13.25em~setLine,13,a foredoomed romance between a French actress and~positionLine,13,409px,8.0em
_~setLine,6,a~positionLine,6,568px,43.25em~styleLine,6,color,red~setLine,9,World War II~positionLine,9,310px,32.0em~setLine,10,French~positionLine,10,580px,17.0em~setLine,14,a Japanese architect~positionLine,14,409px,9.5em
_~setLine,9,World War II~positionLine,9,310px,35.75em~setLine,10,French~positionLine,10,580px,20.75em~setLine,13,~setLine,14,~setLine,14,Japanese architect~positionLine,14,420px,9.5em
_~setLine,9,World War II~positionLine,9,310px,39.5em~setLine,10,French~positionLine,10,580px,24.5em~setLine,14,Japanese architect~positionLine,14,420px,13.25em~setLine,15,They regard the war\\, Hiroshima\\, each other\\, and~positionLine,15,64px,9.5em
_~setLine,9,World War II.~positionLine,9,310px,43.25em~styleLine,9,color,red~setLine,10,French~positionLine,10,580px,28.25em~setLine,14,Japanese architect~positionLine,14,420px,17.0em~setLine,16,even themselves with what seems like boredom.~positionLine,16,64px,11.0em
_~setLine,10,French~positionLine,10,580px,32.0em~setLine,14,Japanese architect~positionLine,14,420px,20.75em~setLine,17,Maybe that's the point though? Or maybe the film~positionLine,17,64px,12.5em
_~setLine,10,French~positionLine,10,580px,35.75em~setLine,14,Japanese architect~positionLine,14,420px,24.5em~setLine,18,was just lost on me.~positionLine,18,64px,14.0em
_~setLine,10,French~positionLine,10,580px,39.5em~setLine,14,Japanese architect~positionLine,14,420px,28.25em~setLine,15,~setLine,16,~setLine,17,~setLine,18,~setLine,15,Hiroshima~positionLine,15,200px,9.5em
_~setLine,10,French~positionLine,10,580px,43.25em~styleLine,10,color,red~setLine,14,Japanese architect~positionLine,14,420px,32.0em~setLine,15,Hiroshima~positionLine,15,200px,13.25em~setLine,19,Gorgeous and yearning; offers a still-modern~positionLine,19,308px,9.5em
_~setLine,14,Japanese architect~positionLine,14,420px,35.75em~setLine,15,Hiroshima~positionLine,15,200px,17.0em~setLine,20,thesis: Memory\\, like love\\, is a commodity that no~positionLine,20,308px,11.0em
_~setLine,14,Japanese architect~positionLine,14,420px,39.5em~setLine,15,Hiroshima~positionLine,15,200px,20.75em~setLine,21,one fully possesses.~positionLine,21,308px,12.5em
_~setLine,14,Japanese architect~positionLine,14,420px,43.25em~styleLine,14,color,red~setLine,15,Hiroshima~positionLine,15,200px,24.5em~setLine,19,~setLine,20,~setLine,21,~setLine,19,yearning~positionLine,19,401px,9.5em
_~setLine,15,Hiroshima~positionLine,15,200px,28.25em~setLine,19,yearning~positionLine,19,401px,13.25em~setLine,22,I'll admit to not caring much about the two people~positionLine,22,860px,9.5em
_~setLine,15,Hiroshima~positionLine,15,200px,32.0em~setLine,19,yearning~positionLine,19,401px,17.0em~setLine,23,at the center of Resnais' drama.~positionLine,23,860px,11.0em
_~setLine,15,Hiroshima~positionLine,15,200px,35.75em~setLine,19,yearn~positionLine,19,401px,20.75em~setLine,22,~setLine,23,~setLine,22,the~positionLine,22,1085px,9.5em
_~setLine,15,Hiroshima~positionLine,15,200px,39.5em~setLine,19,yearn~positionLine,19,401px,24.5em~setLine,22,the~positionLine,22,1085px,13.25em~setLine,24,one cannot help but be moved by these lovelorn~positionLine,24,944px,6.5em
_~setLine,15,Hiroshima~positionLine,15,200px,43.25em~styleLine,15,color,red~setLine,19,yearn~positionLine,19,401px,28.25em~setLine,22,the~positionLine,22,1085px,17.0em~setLine,25,people\\, struggling hopelessly against the~positionLine,25,944px,8.0em
_~setLine,19,yearn~positionLine,19,401px,32.0em~setLine,22,the~positionLine,22,1085px,20.75em~setLine,26,onslaught of time and the devastation of being~positionLine,26,944px,9.5em
_~setLine,19,A~positionLine,19,401px,35.75em~setLine,22,the~positionLine,22,1085px,24.5em~setLine,27,forgotten.~positionLine,27,944px,11.0em
_~setLine,19,A~positionLine,19,401px,39.5em~setLine,22,the~positionLine,22,1085px,28.25em~setLine,24,~setLine,25,~setLine,26,~setLine,27,~setLine,26,devastation~positionLine,26,1110px,9.5em
_~setLine,19,A~positionLine,19,401px,43.25em~styleLine,19,color,red~setLine,22,the~positionLine,22,1085px,32.0em~setLine,26,devastation~positionLine,26,1110px,13.25em~setLine,28,The educated audience often uses “art” films in~positionLine,28,1009px,5.0em
_~setLine,22,the~positionLine,22,1085px,35.75em~setLine,26,devastation~positionLine,26,1110px,17.0em~setLine,29,much the same self-indulgent way as the mass~positionLine,29,1009px,6.5em
_~setLine,22,the~positionLine,22,1085px,39.5em~setLine,26,devastation~positionLine,26,1110px,20.75em~setLine,30,audience uses the Hollywood “product\\,” finding~positionLine,30,1009px,8.0em
_~setLine,22,the~positionLine,22,1085px,43.25em~styleLine,22,color,red~setLine,26,devastation~positionLine,26,1110px,24.5em~setLine,31,wish fulfillment in the form of cheap and easy~positionLine,31,1009px,9.5em
_~setLine,26,devastation~positionLine,26,1110px,28.25em~setLine,32,congratulation on their sensitivities and their~positionLine,32,1009px,11.0em
_~setLine,26,devastation~positionLine,26,1110px,32.0em~setLine,33,liberalism.~positionLine,33,1009px,12.5em
_~setLine,26,devastation~positionLine,26,1110px,35.75em~setLine,28,~setLine,29,~setLine,30,~setLine,31,~setLine,32,~setLine,33,~setLine,31,of ~positionLine,31,1190px,9.5em
_~setLine,26,devastation~positionLine,26,1110px,39.5em~setLine,31,of ~positionLine,31,1190px,13.25em~setLine,34,Spans decades while remaining stubbornly in the~positionLine,34,5px,8.0em
_~setLine,26,devastation~positionLine,26,1110px,43.25em~styleLine,26,color,red~setLine,31,of ~positionLine,31,1190px,17.0em~setLine,35,present tense\\, the way our own memories after ebb~positionLine,35,5px,9.5em
_~setLine,31,of ~positionLine,31,1190px,20.75em~setLine,36,and flow according to what we’re feeling in the~positionLine,36,5px,11.0em
_~setLine,31,of ~positionLine,31,1190px,24.5em~setLine,37,moment.~positionLine,37,5px,12.5em
_~setLine,31,of ~positionLine,31,1190px,28.25em~setLine,34,~setLine,35,~setLine,36,~setLine,37,~setLine,35,after~positionLine,35,275px,9.5em
_~setLine,31,of ~positionLine,31,1190px,32.0em~setLine,35,after~positionLine,35,275px,13.25em~setLine,38,one of the better movies of that genre. It is more~positionLine,38,709px,8.0em
_~setLine,31,of ~positionLine,31,1190px,35.75em~setLine,35,after~positionLine,35,275px,17.0em~setLine,39,realistic and grittier than previous French films~positionLine,39,709px,9.5em
_~setLine,31,of ~positionLine,31,1190px,39.5em~setLine,35,after~positionLine,35,275px,20.75em~setLine,40,of even a few years earlier.~positionLine,40,709px,11.0em
_~setLine,31,of ~positionLine,31,1190px,43.25em~styleLine,31,color,red~setLine,35,after~positionLine,35,275px,24.5em~setLine,38,~setLine,39,~setLine,40,~setLine,39,previous~positionLine,39,870px,9.5em
_~setLine,35,after~positionLine,35,275px,28.25em~setLine,39,previous~positionLine,39,870px,13.25em~setLine,41,the director changes the theme to a love story\\,~positionLine,41,1090px,6.5em
_~setLine,35,after~positionLine,35,275px,32.0em~setLine,39,previous~positionLine,39,870px,17.0em~setLine,42,unhappinness\\, lust and human longing - completely~positionLine,42,1090px,8.0em
_~setLine,35,after~positionLine,35,275px,35.75em~setLine,39,previous~positionLine,39,870px,20.75em~setLine,43,giving up on post-war atomic issues~positionLine,43,1090px,9.5em
_~setLine,35,after~positionLine,35,275px,39.5em~setLine,39,previous~positionLine,39,870px,24.5em~setLine,41,~setLine,42,~setLine,43,~setLine,43,atomic~positionLine,43,1235px,9.5em
_~setLine,35,after~positionLine,35,275px,43.25em~styleLine,35,color,red~setLine,39,previous~positionLine,39,870px,28.25em~setLine,43,atomic~positionLine,43,1235px,13.25em~setLine,44,there's something that annoys me big about that~positionLine,44,436px,8.0em
_~setLine,39,previous~positionLine,39,870px,32.0em~setLine,43,atomic~positionLine,43,1235px,17.0em~setLine,45,movie\\, maybe the fake way they talk\\, or the many~positionLine,45,436px,9.5em
_~setLine,39,previous~positionLine,39,870px,35.75em~setLine,43,atomic~positionLine,43,1235px,20.75em~setLine,46,fake laughes\\, or the weird obssession they have~positionLine,46,436px,11.0em
_~setLine,39,previous~positionLine,39,870px,39.5em~setLine,43,atomic~positionLine,43,1235px,24.5em~setLine,47,for each other\\, but something annoys me~positionLine,47,436px,12.5em
_~setLine,39,previous~positionLine,39,870px,43.25em~styleLine,39,color,red~setLine,43,atomic~positionLine,43,1235px,28.25em~setLine,44,~setLine,45,~setLine,46,~setLine,47,~setLine,45,many~positionLine,45,720px,9.5em
_~setLine,43,atomic~positionLine,43,1235px,32.0em~setLine,45,many~positionLine,45,720px,13.25em~setLine,48,an impressive exercise of film techniques\\, mood~positionLine,48,377px,6.5em
_~setLine,43,atomic~positionLine,43,1235px,35.75em~setLine,45,many~positionLine,45,720px,17.0em~setLine,49,embodying camera work\\, an almost intuitive kind of~positionLine,49,377px,8.0em
_~setLine,43,atomic~positionLine,43,1235px,39.5em~setLine,45,many~positionLine,45,720px,20.75em~setLine,50,musical accompaniment\\, and verismo acting.~positionLine,50,377px,9.5em
_~setLine,43,atomic~positionLine,43,1235px,43.25em~styleLine,43,color,red~setLine,45,many~positionLine,45,720px,24.5em~setLine,48,~setLine,49,~setLine,50,~setLine,50,and~positionLine,50,540px,9.5em
_~setLine,45,many~positionLine,45,720px,28.25em~setLine,50,and~positionLine,50,540px,13.25em~setLine,51,I am not one for melodrama\\, but this piece had me~positionLine,51,760px,5.0em
_~setLine,45,many~positionLine,45,720px,32.0em~setLine,50,and~positionLine,50,540px,17.0em~setLine,52,convinced it was something special. Then it kept~positionLine,52,760px,6.5em
_~setLine,45,many~positionLine,45,720px,35.75em~setLine,50,and~positionLine,50,540px,20.75em~setLine,53,going. And going. And getting more ridiculous. For~positionLine,53,760px,8.0em
_~setLine,45,many~positionLine,45,720px,39.5em~setLine,50,and~positionLine,50,540px,24.5em~setLine,54,hours. And more ridiculous. It is pretty~positionLine,54,760px,9.5em
_~setLine,45,many~positionLine,45,720px,43.25em~styleLine,45,color,red~setLine,50,and~positionLine,50,540px,28.25em~setLine,55,innovative for it's time\\, however\\, but it is a~positionLine,55,760px,11.0em
_~setLine,50,and~positionLine,50,540px,32.0em~setLine,56,bore to watch. A barely passable film-watching~positionLine,56,760px,12.5em
_~setLine,50,and~positionLine,50,540px,35.75em~setLine,57,experience.~positionLine,57,760px,14.0em
_~setLine,50,and~positionLine,50,540px,39.5em~setLine,51,~setLine,52,~setLine,53,~setLine,54,~setLine,55,~setLine,56,~setLine,57,~setLine,54,hours~positionLine,54,760px,9.5em
_~setLine,50,and~positionLine,50,540px,43.25em~styleLine,50,color,red~setLine,54, hours~positionLine,54,760px,13.25em~setLine,58,The first minutes are shocking. Emmanuelle knocks~positionLine,58,1000px,6.5em
_~setLine,54, hours~positionLine,54,760px,17.0em~setLine,59,us off with her beauty while her character reminds~positionLine,59,1000px,8.0em
_~setLine,54, hours~positionLine,54,760px,20.75em~setLine,60,us to ponder how we'll never really know~positionLine,60,1000px,9.5em
_~setLine,54, hours~positionLine,54,760px,24.5em~setLine,61,Hiroshima.~positionLine,61,1000px,11.0em
_~setLine,54, hours~positionLine,54,760px,28.25em~setLine,58,~setLine,59,~setLine,60,~setLine,61,~setLine,60,ponder~positionLine,60,1035px,9.5em
_~setLine,54, hours~positionLine,54,760px,32.0em~setLine,60,ponder~positionLine,60,1035px,13.25em~setLine,62,this exists on a different level. like marienbad\\,~positionLine,62,966px,8.0em
_~setLine,54, hours~positionLine,54,760px,35.75em~setLine,60,ponder~positionLine,60,1035px,17.0em~setLine,63,i begin to nod off but then wake up at the best~positionLine,63,966px,9.5em
_~setLine,54, hours~positionLine,54,760px,39.5em~setLine,60,ponder~positionLine,60,1035px,20.75em~setLine,64,bits. some parts are too beautiful and eerie to~positionLine,64,966px,11.0em
_~setLine,54, hours -~positionLine,54,760px,43.25em~styleLine,54,color,red~setLine,60,ponder~positionLine,60,1035px,24.5em~setLine,65,believe. other parts are too stale to digest~positionLine,65,966px,12.5em
_~setLine,60,ponder~positionLine,60,1035px,28.25em~setLine,62,~setLine,63,~setLine,64,~setLine,65,~setLine,63,the~positionLine,63,1210px,9.5em
_~setLine,60,ponder~positionLine,60,1035px,32.0em~setLine,63,the~positionLine,63,1210px,13.25em~setLine,66,It was not one for entertainment purposes\\, but to~positionLine,66,1121px,8.0em
_~setLine,60,ponder~positionLine,60,1035px,35.75em~setLine,63,the~positionLine,63,1210px,17.0em~setLine,67,inform and juxtapose the bomb with a love affair~positionLine,67,1121px,9.5em
_~setLine,60,ponder~positionLine,60,1035px,39.5em~setLine,63,the~positionLine,63,1210px,20.75em~setLine,68,in Hiroshima. It was painful at times to see the~positionLine,68,1121px,11.0em
_~setLine,60,ponder~positionLine,60,1035px,43.25em~styleLine,60,color,red~setLine,63,the~positionLine,63,1210px,24.5em~setLine,69,harshness.~positionLine,69,1121px,12.5em
_~setLine,63,the~positionLine,63,1210px,28.25em~setLine,66,~setLine,67,~setLine,68,~setLine,69,~setLine,67,bomb~positionLine,67,1285px,9.5em
_~setLine,63,the~positionLine,63,1210px,32.0em~setLine,67,bomb~positionLine,67,1285px,13.25em~setLine,70,the story the actress elaborated on in such a~positionLine,70,542px,9.5em
_~setLine,63,the~positionLine,63,1210px,35.75em~setLine,67,bomb~positionLine,67,1285px,17.0em~setLine,71,great detail nearly put me to sleep.~positionLine,71,542px,11.0em
_~setLine,63,the~positionLine,63,1210px,39.5em~setLine,67,bomb~positionLine,67,1285px,20.75em~setLine,70,~setLine,71,~setLine,70,actress~positionLine,70,625px,9.5em
_~setLine,63,the~positionLine,63,1210px,43.25em~styleLine,63,color,red~setLine,67,bomb~positionLine,67,1285px,24.5em~setLine,70, actress~positionLine,70,625px,13.25em~setLine,72,The makers wanted to tell the story and do\\, in~positionLine,72,783px,8.0em
_~setLine,67,bomb~positionLine,67,1285px,28.25em~setLine,70, actress~positionLine,70,625px,17.0em~setLine,73,fact\\, recount it through images and speech. It~positionLine,73,783px,9.5em
_~setLine,67,bomb~positionLine,67,1285px,32.0em~setLine,70, actress~positionLine,70,625px,20.75em~setLine,74,would be difficult to imagine a silent Hiroshima.~positionLine,74,783px,11.0em
_~setLine,67,bomb~positionLine,67,1285px,35.75em~setLine,70, actress~positionLine,70,625px,24.5em~setLine,75,The dialogue is never really explanatory\\, but~positionLine,75,783px,12.5em
_~setLine,67,bomb~positionLine,67,1285px,39.5em~setLine,70, actress~positionLine,70,625px,28.25em~setLine,76,rather a key component of the story.~positionLine,76,783px,14.0em
_~setLine,67,bomb.~positionLine,67,1285px,43.25em~styleLine,67,color,red~setLine,70, actress~positionLine,70,625px,32.0em~setLine,72,~setLine,73,~setLine,74,~setLine,75,~setLine,76,~setLine,73,recount~positionLine,73,815px,9.5em
_~setLine,70, actress~positionLine,70,625px,35.75em~setLine,73,recount~positionLine,73,815px,13.25em~setLine,77,This French film starts off as a romance set~positionLine,77,736px,9.5em
_~setLine,70, actress~positionLine,70,625px,39.5em~setLine,73,recount~positionLine,73,815px,17.0em~setLine,78,against the backdrop of Hiroshima\\, but then~positionLine,78,736px,11.0em
_~setLine,70, actress - ~positionLine,70,625px,43.25em~styleLine,70,color,red~setLine,73,recount~positionLine,73,815px,20.75em~setLine,79,quickly delves into art house boredom. Meh!~positionLine,79,736px,12.5em
_~setLine,73,recount~positionLine,73,815px,24.5em~setLine,77,~setLine,78,~setLine,79,~setLine,77,romance s~positionLine,77,935px,9.5em
_~setLine,73,recount~positionLine,73,815px,28.25em~setLine,77,romances~positionLine,77,935px,13.25em~setLine,80,Here -- for the first time since Eisenstein -- we~positionLine,80,790px,6.5em
_~setLine,73,recount~positionLine,73,815px,32.0em~setLine,77,romances~positionLine,77,935px,17.0em~setLine,81,have a cinematic intelligence so quick\\, so subtle\\,~positionLine,81,790px,8.0em
_~setLine,73,recount~positionLine,73,815px,35.75em~setLine,77,romances~positionLine,77,935px,20.75em~setLine,82,so original\\, so at once passionate and~positionLine,82,790px,9.5em
_~setLine,73,recount~positionLine,73,815px,39.5em~setLine,77,romances~positionLine,77,935px,24.5em~setLine,83,sophisticated that it can be compared with Joyce\\,~positionLine,83,790px,11.0em
_~setLine,73,recount~positionLine,73,815px,43.25em~styleLine,73,color,red~setLine,77,romances~positionLine,77,935px,28.25em~setLine,84,with Picasso\\, with Berg and Bartók and Stravinksy.~positionLine,84,790px,12.5em
_~setLine,77,romances~positionLine,77,935px,32.0em~setLine,80,~setLine,81,~setLine,82,~setLine,83,~setLine,84,~setLine,82,and~positionLine,82,1005px,9.5em
_~setLine,77,romances~positionLine,77,935px,35.75em~setLine,82,and~positionLine,82,1005px,13.25em
_~setLine,77,romances~positionLine,77,935px,39.5em~setLine,82,and~positionLine,82,1005px,17.0em
_~setLine,77,romances~positionLine,77,935px,43.25em~styleLine,77,color,red~setLine,82,and~positionLine,82,1005px,20.75em
_~setLine,82,and~positionLine,82,1005px,24.5em
_~setLine,82,and~positionLine,82,1005px,28.25em
_~setLine,82,and~positionLine,82,1005px,32.0em
_~setLine,82,and~positionLine,82,1005px,35.75em
_~setLine,82,and~positionLine,82,1005px,39.5em
_~setLine,82,and~positionLine,82,1005px,43.25em~styleLine,82,color,red
_~setLine,85,(4.8 stars)~positionLine,85,720px,46.25em~styleLine,85,color,orange`,
      };

      document.getElementById("select_preset").replaceChildren(
        ...Object.keys(presetTexts).map((key) => {
          const presetOption = document.createElement("option");
          presetOption.textContent = `${key}`;
          presetOption.value = key;
          return presetOption;
        })
      );

      const loadNewPreset = (preset) => {
        const rawText = presetTexts[preset];
        fileText = rawText.split(/\r\n|\n|\r/);
        //document.getElementById("openfile").files = [];
        resetFrameHistory();
        document.getElementById("main").replaceChildren();
        document.getElementById("main").innerHTML = "";
        forward();
        // Remove focus from preset
        document.getElementById("select_preset").blur();
      }

      document
        .getElementById("select_preset")
        .addEventListener("change", function (e) {
          e.stopPropagation();
          loadNewPreset(e.target.value);
        });

      var fileText = [];
      var frameHistory = [];
      const initialFrame = { textIndex: -1, display: {}, lines: [] };
      const resetFrameHistory = () => {
        frameHistory = [initialFrame];
      };
      resetFrameHistory();

      const getLastFrame = () => frameHistory[frameHistory.length - 1];
      const getLastFrameLastLine = () => {
        const lastFrame = getLastFrame();
        return lastFrame.lines[lastFrame.lines.length - 1];
      }

      const getTextIndex = () => {
        return getLastFrame().textIndex;
      };

      

      /*
        frameHistory is composed of frames
        frames are as follows 
        {
          lines: [
            {text: "blah", modifiers: {}, instructions: []},
            {text: "blah", modifiers: {}, instructions: []},
            ...
            {text: "blah", modifiers: {}, instructions: []}]
          display: {

          }
          ... (eventually other stuff I'm sure)
        }
      */

      function run() {}

      function splitTextAndInstructions(rawtext) {
        const sep = rawtext.split("~");
        return {
          text: sep[0],
          instructions: sep
            .slice(1)
            .map((item) =>
              item.split(/(?<!\\),/).map((item) => item.replace(/\\,/g, ","))
            ),
        };
      }

      function getAnimation(rawtext) {
        const text = rawtext.toLowerCase();
        return "appear";
      }

      const styleResets = {
        color: "black",
        fontStyle: "normal",
        textDecoration: "none",
        transition: "all 1s",
      };

      const instructionFunctions = {
        // Per line
        setLine: (frame, lineNumber, text) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber) ? { ...row, text } : row
          ),
        }),
        styleLine: (frame, lineNumber, styleKey, styleValue) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber)
              ? {
                  ...row,
                  modifiers: [
                    ...row.modifiers,
                    [null, null, styleKey, styleValue],
                  ],
                }
              : row
          ),
        }),
        replaceLine: (frame, lineNumber, pattern, replacement) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber)
              ? {
                  ...row,
                  text: row.text.replaceAll(RegExp(pattern, "g"), replacement),
                }
              : row
          ),
        }),
        clearLineStyle: (frame, lineNumber) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber) ? { ...row, modifiers: [] } : row
          ),
        }),
        positionLine: (frame, lineNumber, xPos, yPos) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber)
              ? {
                  ...row,
                  modifiers: [
                    ...row.modifiers,
                    [null, null, "position", "fixed"],
                    [null, null, "left", xPos],
                    [null, null, "top", yPos],
                  ],
                }
              : row
          ),
        }),
        rotationLine: (frame, lineNumber, angle, originX, originY) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber)
              ? {
                  ...row,
                  modifiers: [
                    ...row.modifiers,
                    [null, null, "transformOrigin", `${originX} ${originY}`],
                    [null, null, "transform", `rotate(${angle})`],
                  ],
                }
              : row
          ),
        }),

        // Global
        replace: (frame, pattern, replacement) => ({
          lines: frame.lines.map((row) => ({
            ...row,
            text: row.text.replaceAll(RegExp(pattern, "g"), replacement),
          })),
        }),
        styleLineMatching: (frame, pattern, styleKey, styleValue) => ({
          lines: frame.lines.map((row) =>
            row.text.match(RegExp(pattern, "g"))
              ? {
                  ...row,
                  modifiers: [
                    ...row.modifiers,
                    [null, null, styleKey, styleValue],
                  ],
                }
              : row
          ),
        }),
        styleLineWhere: (frame, lineNumber, pattern, styleKey, styleValue) => ({
          lines: frame.lines.map((row, index) =>
            index === parseInt(lineNumber)
              ? {
                  ...row,
                  modifiers: [
                    ...row.modifiers,
                    [
                      ...getStartAndEndOfMatch(row.text, pattern),
                      styleKey,
                      styleValue,
                    ],
                  ],
                }
              : row
          ),
        }),
      };

      function applyInstruction(frame, instruction) {
        if (!(instruction[0] in instructionFunctions)) {
          return frame;
        }
        const updates = instructionFunctions[instruction[0]](
          frame,
          ...instruction.slice(1)
        );
        return { ...frame, ...updates };
      }

      const getStartAndEndOfMatch = (text, pattern) => {
        const match = RegExp(pattern, "g").exec(text);
        if (match === null) {
          return [0, 0];
        }
        const start = match.index;
        const end = match.index + match[0].length;
        return [start, end];
      };

      function getModifiersFromInstructions(instructions, text) {
        const modifierObj = {
          // Modify a line
          color: (color) => [null, null, "color", color],
          italic: () => [null, null, "fontStyle", "italic"],
          underline: () => [null, null, "textDecoration", "underline"],
          style: (styleKey, styleValue) => [null, null, styleKey, styleValue],
          position: (xPos, yPos) => [
            [null, null, "position", "fixed"],
            [null, null, "left", xPos],
            [null, null, "top", yPos],
          ],
          rotation: (angle, originX, originY) => [
            [null, null, "transformOrigin", `${originX} ${originY}`],
            [null, null, "transform", `rotate(${angle})`],
          ],

          // Modify a range
          colorAt: (start, end, color) => [start, end, "color", color],
          italicAt: (start, end) => [start, end, "fontStyle", "italic"],
          underlineAt: (start, end) => [
            start,
            end,
            "textDecoration",
            "underline",
          ],
          styleAt: (start, end, styleKey, styleValue) => [
            start,
            end,
            styleKey,
            styleValue,
          ],

          // Modify a pattern
          colorWhere: (pattern, color) => [
            ...getStartAndEndOfMatch(text, pattern),
            "color",
            color,
          ],
          italicWhere: (pattern) => [
            ...getStartAndEndOfMatch(text, pattern),
            "fontStyle",
            "italic",
          ],
          underlineWhere: (pattern) => [
            ...getStartAndEndOfMatch(text, pattern),
            "textDecoration",
            "underline",
          ],
          styleWhere: (pattern, styleKey, styleValue) => [
            ...getStartAndEndOfMatch(text, pattern),
            styleKey,
            styleValue,
          ],
        };

        const modifiers = instructions.reduce((agg, instruction) => {
          if (instruction[0] in modifierObj) {
            let modifier = modifierObj[instruction[0]](...instruction.slice(1));
            if (modifier.length > 0 && Array.isArray(modifier[0])) {
              agg.push(...modifier);
            } else {
              agg.push(modifier);
            }
          }
          return agg;
        }, []);
        console.log("modifiers", modifiers);
        return modifiers;
      }

      function updateControlButtons() {
        const nextButton = document.getElementById("nextButton");
        const backButton = document.getElementById("backButton");
        if (nextButton)
          nextButton.disabled = !(getTextIndex() < fileText.length);
        if (backButton) backButton.disabled = !(frameHistory.length > 1);
      }

      function transitionToFrame(newTextIndex) {
        const check = fileText[newTextIndex];
        const { text, instructions } = splitTextAndInstructions(
          fileText[newTextIndex]
        );
        const prevFrame = frameHistory[frameHistory.length - 1];
        const transformedFrame = instructions.reduce(
          applyInstruction,
          prevFrame
        );
        const newFrame = {
          ...transformedFrame,
          textIndex: newTextIndex,
          lines: [
            ...transformedFrame.lines,
            { text, modifiers: [], instructions },
          ],
        };
        frameHistory.push(newFrame);

        updateHTMLToNewFrame(prevFrame, newFrame);
        updateControlButtons();

        if (check.trim().length > 0) {
          return true;
        }
        return false;
      }

      function forward() {
        while (getTextIndex() < fileText.length) {
          const prevFrame = frameHistory[frameHistory.length - 1];
          newTextIndexHasContent = transitionToFrame(getTextIndex() + 1);
          if (newTextIndexHasContent) break;
        }
      }

      var deepEqual = function (x, y) {
        if (x === y) {
          return true;
        } else if (
          typeof x == "object" &&
          x != null &&
          typeof y == "object" &&
          y != null
        ) {
          if (Object.keys(x).length != Object.keys(y).length) return false;

          for (var prop in x) {
            if (y.hasOwnProperty(prop)) {
              if (!deepEqual(x[prop], y[prop])) return false;
            } else return false;
          }

          return true;
        } else return false;
      };

      const appearTextName = "appearText";
      const textContentName = "textContent";
      const fadeOutName = "fadeOutSpan";

      const getTextSpanCount = () =>
        document
          .getElementById("main")
          .getElementsByClassName(appearTextName)
          .length;

      const getTextContentSpan = (index) =>
        document
          .getElementById("main")
          .getElementsByClassName(appearTextName)
          [index].getElementsByClassName(textContentName)[0];

      const getFadeOutSpan = (index) =>
        document
          .getElementById("main")
          .getElementsByClassName(appearTextName)
          [index].getElementsByClassName(fadeOutName)[0];

      let keyControlDisplay;

      const addKeyControlDisplayItem = (keySymbol, preview) => {
        const keyControlDisplayItemContainer = document.createElement("span");
        keyControlDisplayItemContainer.classList.add("keyControlDisplayItemContainer");
        keyControlDisplay.appendChild(keyControlDisplayItemContainer);

        const keyControlDisplayItem = document.createElement("span");
        keyControlDisplayItem.textContent = keySymbol;
        keyControlDisplayItem.classList.add("keyControlDisplayItem");
        keyControlDisplayItemContainer.appendChild(keyControlDisplayItem);

        const keyControlDisplayItemLabel = document.createElement("span");
        keyControlDisplayItemLabel.textContent = preview;
        keyControlDisplayItemLabel.classList.add("keyControlDisplayItemLabel");
        keyControlDisplayItemContainer.appendChild(keyControlDisplayItemLabel);
        
      }

      const updateKeyControlDisplay = () => {
        const lastFrameLastLine = getLastFrameLastLine();
        const lastTextContentSpan = getTextContentSpan(getTextSpanCount() - 1);

        if (!keyControlDisplay) {
          keyControlDisplay = document.createElement("span");
          keyControlDisplay.classList.add("keyControlDisplay");
        }
        keyControlDisplay.replaceChildren();

        const keyInstructions = lastFrameLastLine.instructions.filter(
          (instruction) => instruction[0] === "goToLineOnKey"
        );
        
        keyInstructions.map((instruction) => addKeyControlDisplayItem(instruction[2], instruction[3]));
        
        // include forward instruction
        if (keyInstructions.length > 0) 
          lastFrameLastLine.instructions.filter(
            (instruction) => instruction[0] === "goToLineOnForward"
          ).map((instruction) => addKeyControlDisplayItem("⟶", instruction[2]));

        lastTextContentSpan.appendChild(keyControlDisplay);
      }

      function updateHTMLToNewFrame(oldFrame, newFrame) {
        const { lines: oldLines } = oldFrame;
        const { lines: newLines } = newFrame;

        // Update existing text
        newLines.slice(0, oldLines.length).forEach((row, index) => {
          if (!deepEqual(row, oldLines[index]))
            updateHTMLTextAtIndex(row, index);
        });

        // Remove old text if needed
        if (newLines.length < oldLines.length)
          oldLines.slice(newLines.length).forEach(removeLastHTMLText);

        // Add new text if needed
        if (newLines.length > oldLines.length)
          newLines.slice(oldLines.length).forEach(addHTMLText);

        updateKeyControlDisplay();        
      }

      

      const addModifierToInterval = (intervals, modifier) => {
        const result = intervals.reduce(
          ({ intervals, modifier }, interval, index) => {
            if (modifier === null || modifier.start == modifier.end)
              return { intervals: [...intervals, interval], modifier };

            const modifierEndAfterIntervalStart = modifier.end > interval.start;
            if (!modifierEndAfterIntervalStart)
              return {
                intervals: [...intervals, modifier, interval],
                modifier: null,
              };

            const modifierStartBeforeIntervalEnd =
              modifier.start < interval.end;
            if (!modifierStartBeforeIntervalEnd)
              return { intervals: [...intervals, interval], modifier };

            // Start is before interval end
            // and end is after interval start
            // so there is overlap

            const modifierStartAfterIntervalStart =
              modifier.start > interval.start;
            const modifierEndBeforeIntervalEnd = modifier.end < interval.end;
            const modifierStartEqualsIntervalStart =
              modifier.start == interval.start;

            return {
              intervals: [
                ...intervals,
                ...[
                  modifierStartEqualsIntervalStart
                    ? null
                    : modifierStartAfterIntervalStart
                    ? {
                        start: interval.start,
                        end: modifier.start,
                        style: interval.style,
                      }
                    : {
                        start: modifier.start,
                        end: interval.start,
                        style: modifier.style,
                      },
                ].filter((i) => i !== null),
                {
                  start: modifierStartAfterIntervalStart
                    ? modifier.start
                    : interval.start,
                  end: modifierEndBeforeIntervalEnd
                    ? modifier.end
                    : interval.end,
                  style: [...interval.style, ...modifier.style],
                },
              ],
              modifier: modifierEndBeforeIntervalEnd
                ? {
                    start: modifier.end,
                    end: interval.end,
                    style: interval.style,
                  }
                : {
                    start: interval.end,
                    end: modifier.end,
                    style: modifier.style,
                  },
            };
          },
          { intervals: [], modifier }
        );

        if (
          result.modifier !== null &&
          result.modifier.start !== result.modifier.end
        ) {
          return [...result.intervals, result.modifier];
        } else {
          return result.intervals;
        }
      };

      const updateSpansForRow = (row, existingSpans) => {
        const { instructions, text, modifiers } = row;

        const instructionModifiers = getModifiersFromInstructions(
          instructions,
          text
        );
        const instructionAndRowModifiers = [
          ...instructionModifiers,
          ...modifiers,
        ];

        let intervals = instructionAndRowModifiers.reduce(
          (intervals, modifier) =>
            addModifierToInterval(intervals, {
              start: modifier[0] === null ? 0 : modifier[0],
              end: modifier[1] === null ? text.length : modifier[1],
              style: [modifier.slice(2)],
            }),
          [{ start: 0, end: text.length, style: [] }]
        );

        const newChildren = intervals.map((interval, spanIndex) => {
          const { start, end, style } = interval;

          const textContentSubSpan =
            spanIndex < existingSpans.length
              ? existingSpans[spanIndex]
              : document.createElement("span");
          textContentSubSpan.textContent = text.substring(start, end);
          textContentSubSpan.className = "textContentSubSpan";
          const modDict = Object.fromEntries(style);
          for (const modifierKey in styleResets) {
            textContentSubSpan.style[modifierKey] = styleResets[modifierKey];
          }
          for (const modifierKey in modDict) {
            textContentSubSpan.style[modifierKey] = modDict[modifierKey];
          }
          return textContentSubSpan;
        });

        return newChildren;
      };

      const updateTextContentSpan = (textContentSpan, fadeOutSpan, row) => {
        const existingChildren = [...textContentSpan.children];

        fadeOutSpan.replaceChildren(
          ...existingChildren.map((c) => c.cloneNode(true))
        );

        fadeOutSpan.style.animationName = "none";
        fadeOutSpan.offsetHeight; /* trigger reflow */
        fadeOutSpan.style.animationName = "disappear";

        const newChildren = updateSpansForRow(row, existingChildren);

        textContentSpan.replaceChildren(...newChildren);
        textContentSpan.style.animationName = "none";
        textContentSpan.offsetHeight; /* trigger reflow */
        textContentSpan.style.animationName = "appear";

        if (row.text === "_") {
          textContentSpan.parentElement.style.display = "none";
        } else {
          textContentSpan.parentElement.style.display = "initial";
        }
      };

      function updateHTMLTextAtIndex(row, index) {
        const { text, modifiers } = row;
        const textContentSpan = getTextContentSpan(index);
        const fadeOutSpan = getFadeOutSpan(index);
        updateTextContentSpan(textContentSpan, fadeOutSpan, row);
      }

      function addHTMLText(row) {
        const { text, modifiers } = row;
        const elem = document.getElementById("main");

        const newElem = document.createElement("div");
        elem.appendChild(newElem);
        newElem.classList.add(appearTextName);
        newElem.style.animationName = getAnimation(text);

        const newSpan = document.createElement("span");
        newElem.appendChild(newSpan);
        newSpan.textContent = ":";
        newSpan.style.color = "white";

        const textContentSpan = document.createElement("span");
        newElem.appendChild(textContentSpan);
        textContentSpan.classList.add(textContentName);

        const fadeOutSpan = document.createElement("span");
        newElem.appendChild(fadeOutSpan);
        fadeOutSpan.classList.add(fadeOutName);

        updateTextContentSpan(textContentSpan, fadeOutSpan, row);
      }

      function removeLastHTMLText() {
        const elem = document.getElementById("main");
        elem.removeChild(elem.lastChild);
      }

      function back() {
        while (frameHistory.length > 1) {
          const currentFrame = frameHistory.pop();
          const prevFrame = frameHistory[frameHistory.length - 1];
          const check = fileText[prevFrame.textIndex];

          updateHTMLToNewFrame(currentFrame, prevFrame);
          updateControlButtons();

          if (check.trim().length > 0) {
            break;
          }
        }
      }

      const directionInstructions = {
        goToLineOnForward: (lineNumber) =>
          transitionToFrame(parseInt(lineNumber)),
        goToLineOnBack: (lineNumber) => transitionToFrame(parseInt(lineNumber)),
        goToLineOnKey: (lineNumber, _) =>
          transitionToFrame(parseInt(lineNumber)),
      };

      const followDirectionInsruction = (instruction) => {
        return directionInstructions[instruction[0]](...instruction.slice(1));
      };

      const FORWARD = "FORWARD";
      const BACK = "BACK";

      function checkKey(e) {
        e = e || window.event;

        console.log("frameHistory", frameHistory);

        const lastFrameLastLine = getLastFrameLastLine();
        const keyInstructions = lastFrameLastLine.instructions.filter(
          (instruction) => instruction[0] === "goToLineOnKey"
        );
        const forwardInstructions = lastFrameLastLine.instructions.filter(
          (instruction) => instruction[0] === "goToLineOnForward"
        );
        const backInstructions = lastFrameLastLine.instructions.filter(
          (instruction) => instruction[0] === "goToLineOnBack"
        );

        const letterKeys = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".toLowerCase();
        if (letterKeys.includes(e.key)) {
          const matchedInstructions = keyInstructions.filter(
            (instruction) => instruction[2].toLowerCase() === e.key || instruction[2] === e.key
          );
          if (matchedInstructions.length > 0)
            return followDirectionInsruction(
              matchedInstructions[matchedInstructions.length - 1]
            );
        }

        if (e.keyCode == "38" || e.key == "Backspace" || e.keyCode == "37") {
          // up arrow or left arrow
          if (backInstructions.length > 0)
            return followDirectionInsruction(
              backInstructions[backInstructions.length - 1]
            );
          return back();
        }

        if (
          e.keyCode == "40" ||
          e.key == " " ||
          e.key == "Enter" ||
          e.keyCode == "39"
        ) {
          // down arrow or right arrow
          if (forwardInstructions.length > 0)
            return followDirectionInsruction(
              forwardInstructions[forwardInstructions.length - 1]
            );
          if (keyInstructions.length === 0) return forward();
        }
      }

      document.onkeydown = checkKey;

      const urlParams = new URLSearchParams(window.location.search);
      const autoplay = urlParams.get('autoplay').split(",");
      let currentAutoplayIndex = 0;

      const nextAutoplayStep = () => {
        const textIndex = getTextIndex();
        const maxTextIndex = fileText.length - 1;
        if (textIndex < maxTextIndex) {
          return forward();
        } else {
          currentAutoplayIndex = (currentAutoplayIndex + 1) % autoplay.length;
          loadNewPreset(autoplay[currentAutoplayIndex]);
        }
      }

      if (autoplay && autoplay.length > 0) {
        loadNewPreset(autoplay[currentAutoplayIndex]);
        setInterval(nextAutoplayStep, 2000);
      }
      
    </script>
  </body>
</html>
